// Prisma schema for PriceCalc backend

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id           Int           @id @default(autoincrement())
  email        String        @unique
  password     String
  createdAt    DateTime      @default(now())
  servicios    Servicio[]
  transacciones Transaccion[]
}

model Servicio {
  id           Int       @id @default(autoincrement())
  nombre       String
  monto        Decimal
  vencimiento  DateTime
  periodicidad String    // 'unico' | 'mensual'
  estado       String    @default("por_pagar") // 'por_pagar' | 'pagado' | 'vencido'
  userId       Int
  user         User      @relation(fields: [userId], references: [id])
  pagos        Pago[]
  createdAt    DateTime  @default(now())
  // Nuevos campos
  linkPago     String?
  categoria    String   @default("Otros")
  // Relaci칩n con transacciones (gastos generados al pagar)
  transacciones Transaccion[]
}

model Pago {
  id          Int       @id @default(autoincrement())
  servicioId  Int
  servicio    Servicio  @relation(fields: [servicioId], references: [id])
  fechaPago   DateTime
  montoPagado Decimal
  createdAt   DateTime  @default(now())
}

model Transaccion {
  id           Int      @id @default(autoincrement())
  tipo         String   // 'ingreso' | 'gasto'
  monto        Decimal
  descripcion  String
  categoria    String   // 'Servicios' | 'Hogar' | 'Impuestos' | 'Salud' | 'Educacion'
  fecha        DateTime
  periodicidad String   // 'unico' | 'mensual'
  esRecurrente Boolean  @default(false) // Para identificar transacciones generadas autom치ticamente
  transaccionPadreId Int? // ID de la transacci칩n original (para transacciones recurrentes)
  userId       Int
  user         User     @relation(fields: [userId], references: [id])
  // Enlace opcional al servicio que origin칩 el gasto
  servicioId  Int?
  servicio    Servicio? @relation(fields: [servicioId], references: [id])
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}


